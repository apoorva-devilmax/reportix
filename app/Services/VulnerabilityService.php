<?php

/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

namespace App\Services;

use App\Contracts\VulnerabilityContract;
use App\Contracts\SeverityContract;
use App\Models\Vulnerability;
use Exception;

class VulnerabilityService implements VulnerabilityContract
{
    protected $severity;
            
    function __construct(SeverityContract $severity) {
        $this->severity = $severity;
    }
    
    public function getSeverityRef()
    {
        return $this->severity;
    }
    
    public function getAll($limit = 10)
    {
        return Vulnerability::orderBy('name')->paginate($limit);
    }
    
    public function get($id)
    {
        return Vulnerability::findOrFail($id);
    }
    
    public function save($request, $id = null) {
        try {
            if($id && $id>0){
                $vulnerability = Vulnerability::findOrFail($id);
            } else {
                $vulnerability = new Vulnerability();
                $vulnerability->code = $request->code;
            }            
            $vulnerability->name = $request->name;
            $vulnerability->severity_id = $request->severity;
            $vulnerability->description = $request->description;
            $vulnerability->recommendation = $request->recommendation;        
            $vulnerability->save();
            $status = 'success';
        } catch (Exception $ex) {
            $status = 'failure';
        }
        return $status;
    }
    
    public function remove($id){
        try {
            if($id && $id>0){
                $vulnerability = Vulnerability::destroy($id);
                $status = 'success';
            } else {
                $status = 'failure';
            }
        } catch (Exception $ex) {
            $status = 'failure';
        }
        return $status;
    }
    
    public function getVulnerabilityForDropdown()
    {
        return Vulnerability::orderBy('name')->get();
    }
    
}